---
title: "experiment"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.


## Loading libraries

```{r}
library(tidyverse)

```


## Loading the data
```{r}
library(nycflights13)
#help(flights)
#help(weather)
#help(airports)
#help(planes)
fltrain <- read_csv("fltrain.csv.gz")
```

# Preprocessing
deleting dep_time because that leaks the response variable. 

```{r}
class(fltrain)

fltrain['sched_air_time'] <- fltrain['sched_arr_time']-fltrain['sched_dep_time']
#drops <- c("dep_time", "arr_time", "air_time", "arr_delay", 'sched_arr_time')
drops <- c("dep_time", "arr_time", "air_time", "arr_delay", "year.x")
fltrain <- fltrain[ , !(names(fltrain) %in% drops)]
fltrain
```

# Plan
# do some data filtering and processing
do normalization of every column first except for intercept and response 
do feature selection with cp estimates or k folds cross validation
try pca?

# do hybrid lasso and ridge regression
```{r}
data_df <- fltrain
```
```{r}
colnames(data_df)
```

```{r}
data_df['year.y']
```
```{r}
colnames(data_df)
```
```{r}
head(data_df)
```

```{r}
#full_model <- lm(lifeExp ~ .*. , data=no_country_gm1952)
full_model <- lm(dep_delay ~ wind_gust + precip + manufacturer , data=data_df)
#full_model <- lm(dep_delay ~ . - dst - type , data=data_df)

"dep_delay~month+day+sched_dep_time+sched_arr_time+carrier+flight+origin+dest+distance+hour+minute+time_hour+temp+dewp+humid+wind_dir+wind_speed+wind_gust+precip+pressure+visib+name+lat+lon+alt+tz+dst+tzone+year.y+type+manufacturer+model+engines+seats+speed+engine+sched_air_time"
full_model <- lm(dep_delay~month+day+sched_dep_time+sched_arr_time+carrier+flight , data=data_df)
summary <- round(summary(full_model)$coefficients,6)
sorteddf <- summary[order(summary[,ncol(summary)]),]
sorteddf
summary
```
Error in `contrasts<-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]) : contrasts can be applied only to factors with 2 or more levels

```{r}
colnames(data_df)
```
```{r}
help(paste0)
```

```{r}
names <- colnames(data_df)
names[2]
```

```{r}
set.seed(21)
values <- sample(letters, 1e4, TRUE)

vector <- character(length(colnames(data_df)))
vector <- c(0)
# fast(er)

# drop dep_delay from features because it is reponse
# drop tailnum because it produces too many columns 

drops <- c("dep_delay", 'tailnum')
x_features <- data_df[ , !(names(data_df) %in% drops)]
print(x_features)



for (i in 1:length(colnames(x_features))) 
{
  vector[i] <- colnames(x_features)[i]
  formula <- paste0(vector, sep="", collapse="+")
  full_formula <- paste0(c('dep_delay', formula), sep="", collapse="~")
  print(full_formula)
  #full_model <- lm(full_formula , data=data_df)
}
#   user  system elapsed 
#  0.024   0.000   0.023 
```

```{r}
full_model <- lm(dep_delay~month+day+sched_dep_time+sched_arr_time+carrier+flight , data=data_df)
summary(full_model)
```


#drop tailnum too computationally expensive, adds tooo many columns
```{r}
#full_model <- lm(dep_delay~month+day+sched_dep_time+sched_arr_time+carrier+flight+tailnum , data=data_df)
summary(full_model)
```


```{r}
data_df %>% dplyr::mutate_all(as.factor) %>% str
```

```{r}
(l <- sapply(data_df, function(x) is.factor(x)))
```
 
```{r}
m <- data_df[, l]
m
```

```{r}
data_df
```

```{r}
library(Hmisc)
describe(data_df)
```

